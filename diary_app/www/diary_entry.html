<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Diary Entry</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <section class="main-content">
    <footer class="breadcrumb">SK's view &gt; Diary</footer>
    <h2 class="side-bar">ğŸ“¬ Diary ğŸ“¬</h2>

    <div class="diary-container">
      <h3 id="entry-title"></h3>
      <p id="entry-content" style="white-space: pre-line;"></p>

      <div style="text-align: right; margin-top: 20px;">
        <button class="add-diary-btn" onclick="editDiary()">âœï¸ ìˆ˜ì •</button>
        <button class="add-diary-btn" onclick="deleteDiary()" style="background-color: #cc3333;">ğŸ—‘ï¸ ì‚­ì œ</button>
      </div>
    </div>
  </section>

  <!-- ğŸ”™ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
  <footer style="text-align: center; margin-top: 40px;">
    <button class="add-diary-btn" onclick="goBack()">ğŸ”™ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </footer>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const targetId = parseInt(urlParams.get('id'), 10); // ë¬¸ìì—´ â†’ ìˆ«ì
  
    fetch('http://localhost:3000/api/diary')
      .then((res) => res.json())
      .then((diaries) => {
        const entry = diaries.find(d => d.index === targetId);
  
        if (!entry) {
          document.getElementById('entry-title').innerText = "ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }
  
        document.getElementById('entry-title').innerText = "ì œëª©: " + entry.title;
        document.getElementById('entry-content').innerText = "ë‚´ìš©:\n" + entry.content;
  
        // ì €ì¥ëœ entryë¥¼ ìˆ˜ì •/ì‚­ì œ ì‹œ ì“°ê¸° ìœ„í•´ ì „ì—­ ì €ì¥
        window.currentEntry = entry;
        window.allEntries = diaries;
      })
      .catch((err) => {
        console.error("ì„œë²„ì—ì„œ ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:", err);
        document.getElementById('entry-title').innerText = "ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
      });
  
    function editDiary() {
      location.href = `write_diary.html?edit=${targetId}`;
    }
  
    function deleteDiary() {
      if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  
      // ğŸ‘‰ ì„œë²„ ì‚­ì œ APIê°€ ì—†ìœ¼ë¯€ë¡œ í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚­ì œ ë¡œì§ ìœ ì§€ (ì˜ˆì‹œìš©)
      const updated = window.allEntries.filter(d => d.index !== targetId);
  
      // ì„ì‹œ ë¡œì»¬ ì €ì¥ (ê°œë°œ ì¤‘ì¼ ê²½ìš°), ì‹¤ì œë¡œëŠ” ì‚­ì œ API í•„ìš”
      fetch('http://localhost:3000/api/diary/overwrite', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updated),
      })
        .then((res) => res.json())
        .then(() => {
          alert("ì‚­ì œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤");
          location.href = "diary.html";
        })
        .catch((err) => {
          console.error("ì‚­ì œ ì‹¤íŒ¨:", err);
          alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
        });
    }
  
    function goBack() {
      history.length > 1 ? history.back() : location.href = "diary.html";
    }
  </script>
  
</body>
</html>
