<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Diary</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <footer class="breadcrumb">SK's view &gt; Diary</footer>
  <h2 class="side-bar">ğŸ“¬ Diary ğŸ“¬</h2>
  <section class="main-content">
    <div class="diary-container">
      <input id="diary-search" name="diary-search" type="text" placeholder="ì¼ê¸° ì œëª© ê²€ìƒ‰..." class="diary-search" onkeyup="filterDiaries()" />
      <div id="diary-list" class="diary-list"><!-- JSë¡œ ì¼ê¸° ëª©ë¡ ë¡œë”©ë¨ --></div>
    </div>
  </section>

  <footer style="text-align:center;">
    <button class="add-diary-btn" onclick="location.href='write_diary.html'">+ ìƒˆ ì¼ê¸° ì“°ê¸°</button>
  </footer>

  <script>
    function filterDiaries() {
      const input = document.getElementById('diary-search');
      const filter = input.value.toLowerCase();
      document.querySelectorAll('.diary-box').forEach(box => {
        const title = box.querySelector('h3').innerText.toLowerCase();
        box.style.display = title.includes(filter) ? 'block' : 'none';
      });
    }

    function loadDiaries() {
      const diaryList = document.getElementById('diary-list');
      diaryList.innerHTML = '';
      
      fetch("https://script.google.com/macros/s/AKfycbwixWHG9wGobGM8WgzPfQr9KDN3So41Z8lGVExgXTmq3SwES16dT1GnkaBl1EnZ3ydRsw/exec")
    .then(res => res.json())
        .then(diaries => {
          console.log('ì„œë²„ì—ì„œ ë°›ì€ ì¼ê¸° ëª©ë¡:', diaries);
          if (diaries.length === 0) {
            diaryList.innerHTML = '<p style="text-align:center; color:gray;">ë“±ë¡ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }

          diaries.forEach((d, idx) => {
            const box = document.createElement('div');
            box.className = 'diary-box';
            box.innerHTML = `
              <h3>${d.title}</h3>
              <p>${d.content.slice(0, 50)}...</p>
            `;
            box.onclick = () => location.href = `diary_entry.html?id=${idx}`;
            diaryList.appendChild(box);
          });
        })
        .catch(err => {
          console.error('ì„œë²„ ì—°ê²° ì‹¤íŒ¨:', err);
          diaryList.innerHTML = '<p style="text-align:center; color:red;">ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</p>';
        });
    }

    document.addEventListener('DOMContentLoaded', loadDiaries);
  </script>
</body>
</html>