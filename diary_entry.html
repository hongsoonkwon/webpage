<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Diary Entry</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <section class="main-content">
    <footer class="breadcrumb">SK's view &gt; Diary</footer>
    <h2 class="side-bar">ğŸ“¬ Diary ğŸ“¬</h2>

    <div class="diary-container">
      <h3 id="entry-title"></h3>
      <p id="entry-content" style="white-space: pre-line;"></p>

      <div style="text-align: right; margin-top: 20px;">
        <button id="edit-btn" name="edit-btn" class="add-diary-btn" onclick="editDiary()">âœï¸ ìˆ˜ì •</button>
        <button id="delete-btn" name="delete-btn" class="add-diary-btn" onclick="deleteDiary()" style="background-color: #cc3333;">ğŸ—‘ï¸ ì‚­ì œ</button>
      </div>
    </div>
  </section>

  <footer style="text-align: center; margin-top: 40px;">
    <button id="back-btn" name="back-btn" class="add-diary-btn" onclick="goBack()">ğŸ”™ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const GAS_URL = "https://script.google.com/macros/s/AKfycbxL2Cj999VEShdFU8b_UxbHt14zqf8gPBDC6RZ8GmrYvEg_JwPzGQrErQqVPCh7XAs04Q/exec";
      const urlParams = new URLSearchParams(window.location.search);
      const targetId = parseInt(urlParams.get('id'), 10);

      fetch(GAS_URL)
        .then(res => res.json())
        .then(diaries => {
          const entry = diaries[targetId];

          if (!entry) {
            document.getElementById("entry-title").innerText = "ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            return;
          }

          document.getElementById("entry-title").innerText = `ì œëª©: ${entry.title}`;
          document.getElementById("entry-content").innerText = `ë‚´ìš©:\n${entry.content}`;

          window.currentIndex = targetId;
          window.allEntries = diaries;
        })
        .catch(err => {
          console.error("ì„œë²„ì—ì„œ ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤:", err);
          document.getElementById("entry-title").innerText = "ì¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        });

      window.editDiary = () => {
        location.href = `write_diary.html?edit=${window.currentIndex}`;
      };

      window.deleteDiary = () => {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        const updated = window.allEntries.filter((_, i) => i !== window.currentIndex);

        fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: updated })
        })
          .then(res => res.text())
          .then(() => {
            alert("ì‚­ì œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤");
            location.href = "diary.html";
          })
          .catch(err => {
            console.error("ì‚­ì œ ì‹¤íŒ¨:", err);
            alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤");
          });
      };

      window.goBack = () => {
        history.length > 1 ? history.back() : location.href = "diary.html";
      };
    });
  </script>
</body>
</html>
